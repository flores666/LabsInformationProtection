@model InputModel

@{
    var currentLab = labsContext.LabType;
    ViewData["Title"] = currentLab;
}

<script>
$(document).ready(function() {
    let isDecryptPressed;
    let decryptBtn = $('#decrypt');
    
        $('#clear').click(function (){
            document.querySelectorAll('input').forEach(function (input) {
                input.value = '';
                isDecryptPressed = false;
            });
            decryptBtn.prop('disabled', true);
        });
        
        $('#encrypt, #decrypt').click(function () {
            let input;
            let key = $('#key').val();
            
            if (this.id == 'decrypt') {
                input = document.getElementById('output').value;
                isDecryptPressed = true;
                decryptBtn.prop('disabled', true);
            }
            else {
                input = document.getElementById('input').value;
                isDecryptPressed = false;
            }

            $.ajax({
                url: "/@ViewContext.RouteData.Values["Controller"]/Index",
                type: "POST",
                data: { 
                    model : { Input : input, Key : key },
                    IsDecryptPressed : isDecryptPressed
                },
                dataType: "json",
                success: function (json) {
                    if (json.error == null) {
                        document.getElementById('input').value = json.input;
                        document.getElementById('output').value = json.output;
                        if (!isDecryptPressed) decryptBtn.prop('disabled', false);
                    }
                    else {
                        $('#shared-span').text(json.error);
                    }
                }
            });
        });
    });
</script>

<h1 class="text-center pt-5">@(ViewData["Header"] ?? "")</h1>
<form class="container text-center form pt-5">
<span id="shared-span" class="text-danger d-flex start-0 pb-1"></span>
    <div class="form-floating mb-3">
        <input id="input" asp-for="Input" class="form-control">
        <span class="tooltip-text">Алфавит ввода: @labsContext.LabProperties?.Alphabet?.ToString()</span>
        <label asp-for="Input" class="form-label"></label>
        <span id="input-span" asp-validation-for="Input" class="text-danger"></span>
    </div>

    <div class="form-floating mb-3">
        <input id="key" asp-for="Key" class="form-control">
        <span class="tooltip-text">Правило ввода ключа: @labsContext.LabProperties?.KeyPattern?.ToString()</span>
        <label asp-for="Key" class="form-label"></label>
        <span asp-validation-for="Key" class="text-danger"></span>
    </div>

    <div class="form-floating mb-3">
        <input id="output" asp-for="Output" class="form-control" disabled>
        <label asp-for="Output" class="form-label"></label>
    </div>

    <div class="row">
        <button type="button" class="btn btn-primary bg-dark col me-2 border-0" id="encrypt">Зашифровать</button>
        <button type="button" class="btn btn-primary bg-dark col border-0" id="decrypt" disabled>Расшифровать</button>
        <button type="button" class="btn btn-secondary col-1 ms-2 border-0" id="clear">Очистить</button>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial"/>
}
